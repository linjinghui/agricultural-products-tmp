<div class="modal-header">
	<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
		<li class="fa fa-remove"></li>
	</button>
	<h5 class="modal-title">生产经营许可证</h5>
</div>

<div class="modal-body">
	<form class="form-horizontal" id="ent_license_form">

		<div class="box-body" id="divname">

			<input type="hidden" id="licId" name="licId">
			<input type="hidden" id="entId" name="entId">

			<!--<div class="form-group">
									<label for="ENT_NAME" class="col-sm-2 control-label">主体名称:</label>

									<div class="col-sm-3">
										<input type="text" class="form-control" id="ENT_NAME" name="ENT_NAME" placeholder=""  >
									</div>
									<div class="col-sm-1">
										<span class="spanred">*</span>
									</div>
								</div>
								<div class="form-group">
									<label for="ENT_UNICODE" class="col-sm-2 control-label">主体代码:</label>

									<div class="col-sm-3">
										<input type="text" class="form-control" id="ENT_UNICODE" name="ENT_UNICODE" placeholder="">
									</div>
									<div class="col-sm-1">
										<span class="spanred">*</span>
									</div>

								</div>-->

			<!--<div class="col-sm-6">
				<input type="radio" data-flag="dictSelector" data-code="enterprisetype" name="entProperty" data-text="dictName" data-value="dictValue" style="width:130px;" data-blank="true">
			</div>-->

			<div class="form-group">
				<label for="licType" class="col-sm-2 control-label">许可证类型:</label>
				<div class="col-sm-3">
					<select class="form-control select2" style="width: 215px;" data-code="licenseType" data-flag="dictSelector" name="licType"
					    data-text="dictName" data-value="dictCode" data-placeholder="请选择许可证类型" style="width:130px;" data-blank="true">
					</select>
				</div>
				<div class="col-sm-1">
					<span class="spanred">*</span>
				</div>
			</div>
			<div class="form-group">
				<label for="licNo" class="col-sm-2 control-label">许可证编号:</label>

				<div class="col-sm-3">
					<input type="text" class="form-control" id="licNo" name="licNo" placeholder="">
				</div>
				<div class="col-sm-1">
					<span class="spanred">*</span>
				</div>
			</div>
			<div class="form-group">
				<label for="licIssueDate" class="col-sm-2 control-label">发证日期:</label>
				<div class="col-sm-3">
					<input type="text" class="form-control" placeholder="请选择" data-flag="datepicker" data-format="yyyy-mm-dd" id="licIssueDate"
					    name="licIssueDate">
				</div>
				<div class="col-sm-1">
					<span class="spanred">*</span>
				</div>
			</div>
			<div class="form-group">
				<label for="licValidEndDate" class="col-sm-2 control-label">有效期至:</label>
				<div class="col-sm-3">
					<input type="text" class="form-control" placeholder="请选择" data-flag="datepicker" data-format="yyyy-mm-dd" id="licValidEndDate"
					    name="licValidEndDate">
				</div>
				<div class="col-sm-1">
					<span class="spanred">*</span>
				</div>
			</div>
			<div class="form-group">
				<label for="remark" class="col-sm-2 control-label">备注:</label>

				<div class="col-xs-8">
					<textarea class="form-control" rows="3" placeholder="" id="remark" name="remark"></textarea>
				</div>
			</div>

			<input type="hidden" name="fileIds" id="fileIds" value="">
			<div class="form-group" id="file_container">
				<label class="col-sm-2 control-label" for="file">许可证图片</label>
				<div class="col-xs-8">
					<input type="file" id="file" name="file">
				</div>
			</div>

			<div class="box-footer text-right">
				<!--以下两种方式提交验证,根据所需选择-->
				<button type="button" class="btn btn-default" data-btn-type="cancel" data-dismiss="modal">取消</button>
				<button type="submit" id="save" class="btn btn-primary" data-btn-type="save">提交</button>
			</div>

			<!--<hr class="hr0" style="height:1px;border:none;border-top:1px dashed #999999;" />
			<div></div>
			<p style="float: left"><span class="spanred">*</span>食品生产/经营许可证</p>
			<p style="float: left;margin-left: 30px"><span class="spanred">注：食品生产，经营企业必须上传</span></p>
			<p><button>上传附件</button></p>
			<p><img src="../../dist/img/user2-160x160.jpg" alt=""></p>-->
		</div>
	</form>
</div>
<script type="text/javascript">
	var entId = $("#main_entId").val();
	var form = null;
	var url = $("#winId").attr("src");
	var id = getQueryString(url, "id");
	if (id == null) id = "0";
	var type = getQueryString(url, "type");

	$(function () {

		//初始化控件
		form = $("#ent_license_form").form();
		$("#entId").val(entId);
		//数据校验
		$("#ent_license_form").bootstrapValidator({

			message: '请输入有效值',
			feedbackIcons: {
				valid: 'glyphicon glyphicon-ok',
				invalid: 'glyphicon glyphicon-remove',
				validating: 'glyphicon glyphicon-refresh'
			},
			submitHandler: function (validator, userform, submitButton) {
				modals.confirm('确认保存？', function () {
					var params = form.getFormSimpleData();

					$.ajax({
						type: "post",
						url: webapi + "/ent_main_license/saveOrUpdate ",
						data: params,
						success: function (data) {
							if (data.success) {
								var ret = data.ret
								if (id != "0") {
									modals.info("数据更新成功");
								} else {
									modals.info("数据保存成功");

									$('#boot_license').bootstrapTable('refresh');

								}
							} else {
								modals.error("保存失败,请联系管理员!");
							}
						},
					});




				});
			},
			fields: {

				licType: {
					validators: {
						notEmpty: {
							message: '请选择许可证类型'
						}
					}
				},
				licNo: {
					validators: {
						notEmpty: {
							message: '请选择许可证编号'
						}
					}
				},
				licIssueDate: {
					validators: {
						notEmpty: {
							message: '请选择发证日期'
						}
					}
				},
				licValidEndDate: {
					validators: {
						notEmpty: {
							message: '请选择有效期至'
						}
					}
				}
			}
		});

		form.initComponent();

		$("#file").file({
			title: "请上传附件",
			fileinput: {
				maxFileSize: 10240,

				maxFileCount: 1
			},
			fileIdContainer: "[name='fileIds']",
			showContainer: '#file',
			// container:'#file_container',
			showContainer: '#file',
			window: false
		});

		//设置只读状态
		if (type && type == 'view') {
			setFormRead();
		}

		//回填id
		if (id != "0") {
			var url = webapi + "/ent_main_license/getInfo";
			var para = {
				licId: id
			};
			form.ajaxFormData(url, para);
		}
	});

	function resetForm() {
		form.clearForm();
		$("#ent_license_form").data('bootstrapValidator').resetForm();
	}



	//设置只读
	function setFormRead() {
		$('#ent_license_form').find('input,textarea,select').not('').attr('disabled', true);
		$('[type="submit"]').css('display', 'none')
	}
</script>
