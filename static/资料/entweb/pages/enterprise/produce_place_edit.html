<div class="modal-header">
	<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
		<li class="fa fa-remove"></li>
	</button>
	<h5 class="modal-title">新增生产基地</h5>
</div>

<div class="modal-body">

	<form id="place-form" name="place-form" class="form-horizontal">
		<input type="hidden" name="pplaceId" id="pplaceId">
		<input type="hidden" name="entId" id="entId">

		<div class="box-body">

			<div class="form-group">
				<label for="placeName" class="col-sm-2 control-label">基地名称</label>
				<div class="col-sm-4">
					<input type="text" class="form-control" id="placeName" name="placeName" placeholder="基地名称">
				</div>
				<div class="col-sm-0">
					<span class="spanred">*</span>
				</div>
			</div>

			<div class="form-group">
				<label for="placeArea" class="col-sm-2 control-label">基地面积</label>
				<div class="col-sm-4">
					<input type="text" class="form-control" id="placeArea" name="placeArea" placeholder="基地面积">
				</div>
				<span>亩</span>
			</div>

			<div class="form-group">
				<label for="placeLongitude" class="col-sm-2 control-label">经度：</label>
				<div class="col-sm-3">
					<input type="text" class="form-control" id="placeLongitude" name="placeLongitude" placeholder="地址经度">
				</div>

				<label for="placeLatitude" class="col-sm-2 control-label">纬度：</label>
				<div class="col-sm-3">
					<input type="text" class="form-control" id="placeLatitude" name="placeLatitude" placeholder="地址纬度">
				</div>
			</div>

			<div class="form-group">
				<label for="placeDescription" class="col-sm-2 control-label">基地概况:</label>
				<div class="col-sm-9">
					<textarea name="" id="editor" cols="30" rows="10"></textarea>
				</div>

			</div>

			<div class="form-group">
				<label for="contactName" class="col-sm-2 control-label">负责人：</label>
				<div class="col-sm-3">
					<input type="text" class="form-control" id="contactName" name="contactName" placeholder="负责人姓名">
				</div>

				<label for="contactNumber" class="col-sm-2 control-label">联系电话：</label>
				<div class="col-sm-3">
					<input type="text" class="form-control" id="contactNumber" name="contactNumber" placeholder="联系电话">
				</div>

			</div>

			<!-- /.box-body -->
			<div class="box-footer text-right">
				<!--以下两种方式提交验证,根据所需选择-->
				<button type="button" class="btn btn-default" data-btn-type="cancel" data-dismiss="modal">取消</button>
				<button type="submit" class="btn btn-primary" data-btn-type="save">提交</button>
			</div>
		</div>
		<!-- /.box-footer -->
	</form>

</div>
<script>
	//tableId,queryId,conditionContainer
	var entId = $("#main_entId").val();

	var form = null;
	var url = $("#winId").attr("src");
	var id = getQueryString(url, "id");
	if(id == null) id = "0";
	var type = getQueryString(url, "type");

	//初始化富文本编辑器
	CKEDITOR.replace('editor', {});

	$(function() {

		//初始化控件
		form = $("#place-form").form();
		$("#entId").val(entId);
		//数据校验
		$("#place-form").bootstrapValidator({
			message: '请输入有效值',
			feedbackIcons: {
				valid: 'glyphicon glyphicon-ok',
				invalid: 'glyphicon glyphicon-remove',
				validating: 'glyphicon glyphicon-refresh'
			},
			submitHandler: function(validator, userform, submitButton) {
				modals.confirm('确认保存？', function() {
					var params = form.getFormSimpleData();
					$.ajax({
						type: "post",
						url: webapi + "/ent_main_produce_place/saveOrUpdate ",
						data: params,
						success: function (data) {
							if (data.success) {
								var ret = data.ret
								if (id != "0") {
									 modals.info("数据更新成功");
								} else { 
									modals.info("数据保存成功");
								}
								
								$('#boot_place').bootstrapTable('refresh');
								
							} else {
								modals.error("保存失败,请联系管理员!");
							}
						},
					});
				});
			},
			fields: {
				placeName: {
					validators: {
						notEmpty: {
							message: '请输入基地名称'
						}
					}
				}

			}
		});

		form.initComponent();

		//设置只读状态
		if(type && type == 'view') {
			setFormRead();
		}

		//初始化富文本编辑器

		//回填id
		if(id != "0") {
			var url = webapi + "/ent_main_produce_place/getInfo";
			var para = {
				pplaceId: id
			}
			
			form.ajaxFormData(url, para, setEditor);

		}

	});

	function resetForm() {
		form.clearForm();
		$("#place-form").data('bootstrapValidator').resetForm();
	}

	//设置富文本编辑器函数
	var setEditor = function(ret) {
		//富文本编辑器赋值
		setTimeout(function() {
			var html = ret.placeDescription;

			waitCKEditorReady(html);
		}, 50);
		if(type && type == 'view')
			CKEDITOR.instances.editor.setReadOnly(true); //只读

	}
	//设置只读
	function setFormRead() {
		$('#place-form').find('input,textarea,select').not('').attr('disabled', true); 
		$('[type="submit"]').css('display', 'none')

	}
</script>