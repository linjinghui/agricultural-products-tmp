<div class="modal-header">
	<button type="button" class="close" data-dismiss="modal" aria-hidden="true">
		<li class="fa fa-remove"></li>
	</button>
	<h5 class="modal-title">新增生产工厂</h5>
</div>

<div class="modal-body">

	<form id="factory-form" name="factory-form" class="form-horizontal">
		<input type="hidden" name="factId" id="factId">
		<input type="hidden" name="entId" id="entId">


		<div class="box-body">

			<div class="form-group">
				<label for="factName" class="col-sm-2 control-label">工厂名称</label>
				<div class="col-sm-9">
					<input type="text" class="form-control" id="factName" name="factName" placeholder="工厂名称">
				</div>
				<div class="col-sm-0">
					<span class="spanred">*</span>
				</div>
			</div>

			<div class="form-group">
				<label for="factAddr" class="col-sm-2 control-label">工厂地址</label>
				<div class="col-sm-9">
					<input type="text" class="form-control" id="factAddr" name="factAddr" placeholder="工厂地址">
				</div>

			</div>

			<div class="form-group">
				<label for="PLACE_LONGITUDE" class="col-sm-2 control-label">经度：</label>
				<div class="col-sm-3">
					<input type="text" class="form-control" id="placeLongitude" name="placeLongitude" placeholder="地址经度">
				</div>

				<label for="PLACE_LATITUDE" class="col-sm-2 control-label">纬度：</label>
				<div class="col-sm-3">
					<input type="text" class="form-control" id="placeLatitude" name="placeLatitude" placeholder="地址纬度">
				</div>
			</div>
			<div class="form-group">
				<label for="factDescription" class="col-sm-2 control-label">工厂介绍:</label>
				<div class="col-sm-9">
					<!--
					<textarea class="form-control" rows="3" placeholder="" id="factDescription" name="factDescription"></textarea>
					-->
					<textarea name="" id="editor" cols="30" rows="10"></textarea>
				</div>

			</div>
			<div class="form-group">
				<label for="factProducts" class="col-sm-2 control-label">主要产品:</label>
				<div class="col-sm-9">
					<textarea class="form-control" rows="3" placeholder="" id="factProducts" name="factProducts"></textarea>
				</div>

			</div>

			<div class="form-group">
				<label for="contactName" class="col-sm-2 control-label">负责人：</label>
				<div class="col-sm-3">
					<input type="text" class="form-control" id="contactName" name="contactName" placeholder="负责人姓名">
				</div>

				<label for="contactNumber" class="col-sm-2 control-label">联系电话：</label>
				<div class="col-sm-3">
					<input type="text" class="form-control" id="contactNumber" name="contactNumber" placeholder="联系电话">
				</div>

			</div>

			<!-- /.box-body -->
			<div class="box-footer text-right">
				<!--以下两种方式提交验证,根据所需选择-->
				<button type="button" class="btn btn-default" data-btn-type="cancel" data-dismiss="modal">取消</button>
				<button type="submit" id="save" class="btn btn-primary" data-btn-type="save">提交</button>
			</div>
		</div>
		<!-- /.box-footer -->
	</form>

</div>
<script>
	var entId = $("#main_entId").val();
	var form = null;
	var url = $("#winId").attr("src");
	var id = getQueryString(url, "id");
	if (id == null) id = "0";
	var type = getQueryString(url, "type");

	//初始化富文本编辑器
	CKEDITOR.replace('editor', {});


	$(function () {
		initFormSrc();
		//初始化控件
		form = $("#factory-form").form();

		$("#entId").val(entId);
		//数据校验
		$("#factory-form").bootstrapValidator({
			message: '请输入有效值',
			feedbackIcons: {
				valid: 'glyphicon glyphicon-ok',
				invalid: 'glyphicon glyphicon-remove',
				validating: 'glyphicon glyphicon-refresh'
			},
			submitHandler: function (validator, userform, submitButton) {
				modals.confirm('确认保存？', function () {
					var editor_getdata = CKEDITOR.instances.editor.getData();

					var params = form.getFormSimpleData();
					$.ajax({
						type: "post",
						url: webapi + "/ent_main_factory/saveOrUpdate",
						data: params,
						success: function (data) {
							if (data.success) {
								var ret = data.ret
								if (id != "0") {
									modals.info("数据更新成功");
								} else {
									modals.info("数据保存成功");
								}

								$('#boot_factory').bootstrapTable('refresh');


							} else {
								modals.error("保存失败,请联系管理员!");
							}
						},
					});
				});
			},
			fields: {
				factName: {
					validators: {
						notEmpty: {
							message: '请输入工厂名称'
						}
					}
				}
			}
		});
		form.initComponent();

		//设置只读状态
		if (type && type == 'view') {
			setFormRead();
		}


		if (id != "0") {
			var url = webapi + "/ent_main_factory/getInfo";
			var para = {
				factId: id
			}
			form.ajaxFormData(url, para, setEditor);
		}
	});



	function resetForm() {
		form.clearForm();
		$("#factory-form").data('bootstrapValidator').resetForm();
	}


	//设置富文本编辑器函数
	var setEditor = function (ret) {
		//富文本编辑器赋值
		setTimeout(function () {
			var html = ret.factDescription;

			waitCKEditorReady(html);
		}, 50);

		if (type && type == 'view')
			CKEDITOR.instances.editor.setReadOnly(true); //只读

	}

	//设置只读
	function setFormRead() {
		$('#factory-form').find('input,textarea,select').not('').attr('disabled', true);
		$('[type="submit"]').css('display', 'none')

	}

	function initFormSrc() {
		var src = webapi + "/ent_main_factory/getAllInfo";
		$("#factName").attr("data-src", src);
	}
</script>
